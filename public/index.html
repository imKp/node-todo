<!DOCTYPE html>
<html>
<head>
	<title>Light Pixel Animation Display</title>
	<!-- -->
</head>
<style>	
	 rect.bordered {
        stroke: #E6E6E6;
        stroke-width:2px;   
      }

      text.mono {
        font-size: 9pt;
        font-family: Consolas, courier;
        fill: #aaa;
      }

      text.axis-workweek {
        fill: #000;
      }

      text.axis-worktime {
        fill: #000;
      }

     .axis {
	  font: 10px sans-serif;
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}
	li{
		padding-right: 40px;
		text-align:center;
	}
	#containor{
		text-align:center;	
		padding-left:15%;
		padding-right:15%;	
		width:960px;	
	}
    	#heatMap{
		text-align: center;
		padding: 200px;
		margin:10px;
	}
	#inds{
	position:absolute;
	top:10px;
	left:10px; float:right;
}

</style>
<script src="https://d3js.org/d3.v3.js"></script>
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<body>
	<div id="container">
		<div id="chart" align="left"></div>
		<div id="colorSelectorMenu" align="left"></div>
		<div id="matrixRow" align="center"></div>
		<div id="matrixColumn" align="left"></div>
		<button class="btn1">Done</button>
		
		 <input type="text" id="nameOfDesign">
		<div id="saveDesign">
    			<input name="updateButton" 
          			 type="button" 
           			value="Save Design" 
           			onclick="updateDesign()" />
		</div>

		<div id="searchDesignDD">
			<input name="searchDesignDDButton" 
          			 type="button" 
           			value="Load Design" 
           			onclick="retriveNames()" />
		</div>
		<div id="designView" align="left"></div>
		<input type="text" id="nameOfEditedDesign">
		<div id="saveEditedDesign">
    			<input name="updateButton" 
          			 type="button" 
           			value="Save Updated Design" 
           			onclick="updateDesignSave()" />
		</div>
	</div>
	
	<script>
		var margin = { top: 50, right: 0, bottom: 100, left: 30 },
          	width =  500 - margin.left - margin.right,
          	height = 500 - margin.top - margin.bottom,
          	gridSize = Math.floor(width / 24),
          	legendElementWidth = gridSize*2,
          	buckets = 9,
          	colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"], // alternatively colorbrewer.YlGnBu[9]
          	days = ["1R", "2R", "3R", "4R", "5R", "6R", "7R", "8R"],
          	times = ["1C", "2C", "3C", "4C", "5C", "6C", "7C", "8C"];
		
          

      		var svg = d3.select("#chart").append("svg")
          		  	.attr("width", width + margin.left + margin.right)
          			.attr("height", height + margin.top + margin.bottom)
          			.append("g")
          			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      
		/*var drawPixel = function(numRow, numCol){
					d3.selectAll("#chart rect").remove();
					d3.json("designOne.json", function(error, data){
						//console.log(typeof(data));
						
						for(var propt in data){
    							var valuesArrayTemp = [];						
							for(var i = 0; i< numCol; i++){						
							valuesArrayTemp.push(data[propt][i]);								
							//console.log(data[8][i]);	
							}				
							dataRow = valuesArrayTemp;	
							//console.log(dataRow);		
							svg.selectAll("chart")
							.data(dataRow).enter()
							.append("rect")
							.attr("x", function(data, i){ return i * 15;})
              						.attr("y", function(data, i){ return propt * 15;})
              						.attr("width",  14)
              						.attr("height", 14).style('fill', "white").style('stroke-width', 0.7).style('stroke', "black")
							.on("click", function(d){d3.select(this).style('fill', function(){var color = onchangeColor(); return color;}); })
							.on("dblclick", function(d){d3.select(this).style('fill', "white"); onchangeColor();});
						//.on("mouseover", function(){console.log("Yep! you hit me.");});

						}						
					});						
				}*/
		
		var drawMatrix = function(numRow, numCol){
						//console.log(numRow, numCol);
						d3.selectAll("#chart rect").remove();
						var row;
						var column;
						for(row = 1; row <= numRow; row++){//console.log(numCol);
							for(column = 1; column <= numCol; column++){
								data = [column];
								//console.log(data);
								svg.selectAll("#chart")
								.data(data).enter()
								.append("rect")
								.attr("x", function(){ console.log(column); return column * 15;})
              							.attr("y", function(){ return row * 15;})
              							.attr("width",  14)
              							.attr("height", 14).style('fill', "white").style('stroke-width', 0.7).style('stroke', "black")
								.on("click", function(d){d3.select(this).style('fill', function(){var color = onchangeColor(); return color;}); })
								.on("dblclick", function(d){d3.select(this).style('fill', "white"); onchangeColor();});
								//console.log("You hit me!");
							}	
						};
						/*for(i = 1; i <= 32; i++){
							console.log(i);}*/
					}
				

			//svg.selectAll("#chart rect").on("mouseover", function(){console.log("Yep! you hit me.");});

var dataColor = ["red", "blue", "green", "yellow", "magenta", "cyan", "white", "black"];

var selectColor = d3.select('#colorSelectorMenu')
  .append('select')
  	.attr('class','select')
	.attr('size', 8)
    .on('change',onchangeColor());

var optionsColor = selectColor
  .selectAll('option')
	.data(dataColor).enter()
	.append('option')
	
		.text(function (d) { return d; }).attr;

function onchangeColor() {
	selectValue = d3.select('#colorSelectorMenu select').property('value');
	//console.log(selectValue);
	//colorsOfElement();
	return selectValue;
};

var globalPixelData = [];

function colorsOfElement(){		
d3.selectAll("#chart rect").each(function(d,i) {
  //console.log(typeof(d3.select(this).style("fill"))); 
	 var rgb = d3.select(this).style("fill").match(/\d+/g);
    //console.log(rgb); 
  globalPixelData.push(rgb); 
})}

/********/

var matrixRowData = [];

matrixRowData = function(){
	var tempRowData = []
	for(i = 1; i <= 32; i++){
		if( i%2 == 0){tempRowData.push(i);}
		//console.log(tempRowData);
	}
	
	return tempRowData;
}


var matrixRow = d3.select('#matrixRow')
  .append('select')
  	.attr('class','select')
	.on("change", function(d){var nosOfColumn = onchangeColumn(); var nosOfRow = onchangeRow(); drawMatrix(nosOfRow, nosOfColumn)});
    

var optionsRow = matrixRow
  .selectAll('option')
	.data(matrixRowData).enter()
	.append('option')
		.text(function (d) { return d; });

function onchangeRow() {
	selectValue = d3.select('#matrixRow select').property('value');
	//console.log(selectValue);
	return selectValue;
};



/******/
var matrixColumnData = [];
var globalFileName;

matrixColumnData = function(){
	var tempColumnData = []
	for(i = 1; i <= 32; i++){
		if(i%2 == 0){tempColumnData.push(i);}
		//console.log(tempColumnData);
	}
	
	return tempColumnData;
}


var matrixColumn = d3.select('#matrixColumn')
  .append('select')
  	.attr('class','select')
	.on("change", function(d){var nosOfColumn = onchangeColumn(); var nosOfRow = onchangeRow(); drawMatrix(nosOfRow, nosOfColumn)});
    

var optionsColumn = matrixColumn
  .selectAll('option')
	.data(matrixColumnData).enter()
	.append('option')
		.text(function (d) { return d; });

function onchangeColumn() {
	selectValue = d3.select('#matrixColumn select').property('value');
	//console.log(selectValue);
	return selectValue;
};



/*function updateDesignNew(){
  d3.xhr('http://localhost:8080/api/todos')
    .header("Content-Type", "application/json")
    .post(
        JSON.stringify({name: "bob", order: [4, 4], pixel: [20, 30, 40]})
    );
}*/

function updateDesign(){
	globalPixelData = [];
	var name = document.getElementById("nameOfDesign").value;
	var orderData = [];
	var pixelData = [];
	orderData.push(onchangeRow()); 
	orderData.push(onchangeColumn());
	//nameOfDesignF();
	var name = document.getElementById("nameOfDesign").value + orderData.toString();
	colorsOfElement()
	//console.log(typeof(name));
  d3.xhr('http://192.168.2.11:8080/api/todos/')
    .header("Content-Type", "application/json")
    .post(
        JSON.stringify({
		text: name, 
		order: orderData, 
		pixel: globalPixelData })
    );
	
}



$(document).ready(function(){
    $(".btn1").click(function(){
        $("#matrixRow").hide(); $("#matrixColumn").hide();
    });
});

/******/

var nameOfDesignBox = d3.select('#nameOfDesign')

nameOfDesignBox.append('input')
    .attr('type','text')
    .attr('name','textInput');

function nameOfDesignF(){		
d3.selectAll("#nameOfDesign input").each(function(d,i) {
  globalFileName = d3.select(this).attr("value");
})}


/********/

var designNamesFromdb = [];


var titleToGuide = ["Look For your Designs Here"];



var designSearchDD = d3.select('#searchDesignDD')
  .append('select')
  	.attr('class','select')
	.attr('size',5);
	//.on("click", function(){console.log("Yep Hit Me!"); nameOfTheDesign();});	
	


var optionsSaved =  designSearchDD
			.selectAll('option')
			.data(titleToGuide).enter()
			.append('option')
			.text(function (d){ return d;});

function retriveNames(){
	d3.selectAll("#searchDesignDD option").remove();
	d3.json("http://192.168.2.11:8080/api/todos", function(error, data, i){
		designNamesFromdb = [];		
		for(var i = 0; i < data.length; i++){		
		var optionsSaved =designNamesFromdb.push(data[i]["text"]); 
		}
		designSearchDD.selectAll('option')
			.data(designNamesFromdb).enter()
			.append('option').sort(d3.ascending)
			.text(function (d){ return d;})
			.on("dblclick", function(){ nameOfTheDesign = d3.select(this).property('value');/*console.log("Yep Hit Me!"); console.log(nameOfTheDesign);*/ loadDesign(nameOfTheDesign);});	
	});
}

/*function nameOfTheDesign() {
	selectValue = d3.select('#searchDesignDD option').property('value');
	console.log(selectValue);
	return selectValue;
};*/

/*********/

var designmargin = { top: 50, right: 0, bottom: 100, left: 30 },
          	designwidth =  700 - designmargin.left - designmargin.right,
          	dsignheight = 700 - designmargin.top - designmargin.bottom,
          	designgridSize = Math.floor(designwidth / 24),
          	designlegendElementWidth = designgridSize*2;
          	/*buckets = 9,
          	colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"], // alternatively colorbrewer.YlGnBu[9]
          	days = ["1R", "2R", "3R", "4R", "5R", "6R", "7R", "8R"],
          	times = ["1C", "2C", "3C", "4C", "5C", "6C", "7C", "8C"];*/
		
          

      		var designsvg = d3.select("#designView").append("svg")
          		  	.attr("width", designwidth + designmargin.left + designmargin.right)
          			.attr("height", dsignheight + designmargin.top + designmargin.bottom)
          			.append("g")
          			.attr("transform", "translate(" + designmargin.left + "," + designmargin.top + ")");



designRect = [1];

var orderOfUpdatedMatrix = []; 

var loadDesign = function(nameOfTheDesign){
		
	/*console.log(nameOfTheDesign);*/d3.selectAll("#designView rect").remove();
	url = 'http://192.168.2.11:8080/api/todos/text/' + nameOfTheDesign; 
	d3.json(url, function(error, data){
	orderOfUpdatedMatrix = data[0]["order"] 	
	nosOfRows = data[0]["order"][0];
	nosOfColumn = data[0]["order"][1];
	pixelInfo = data[0]["pixel"];	
	console.log(nosOfRows, nosOfColumn, pixelInfo);	
			designsvg.selectAll("#designView")
								.data(pixelInfo).enter()
								.append("rect")
								.attr("x", function(d, i){ valueOfx = i%nosOfColumn; return valueOfx *15;})
              							.attr("y", function(d, i){ valueOfy = Math.floor(i/nosOfColumn); return valueOfy * 15;})
              							.attr("width",  14)
              							.attr("height", 14).style('fill', function(d, i){
									console.log(d.toString());
									rgbValue = "rgb(" + d.toString() + ")";
									return rgbValue; 				
								})								
								.style('stroke-width', 0.7).style('stroke', "black")
								.on("click", function(d){d3.select(this).style('fill', function(){var color = onchangeColor(); return color;}); })
								.on("dblclick", function(d){d3.select(this).style('fill', "white"); onchangeColor();});

});
}

var globalPixelDataUpdate = [];


function colorsOfElementUpdated(){
globalPixelDataUpdate = [];		
d3.selectAll("#designView rect").each(function(d,i) {
  //console.log(typeof(d3.select(this).style("fill"))); 
	 var rgb = d3.select(this).style("fill").match(/\d+/g);
    //console.log(rgb); 
  globalPixelDataUpdate.push(rgb); 
})}

updateDesignSave = function (){
colorsOfElementUpdated();
console.log(globalPixelDataUpdate);	
console.log(orderOfUpdatedMatrix);

var name = document.getElementById("nameOfEditedDesign").value;
	colorsOfElement()
	//console.log(typeof(name));
  d3.xhr('http://192.168.2.11:8080/api/todos/')
    .header("Content-Type", "application/json")
    .post(
        JSON.stringify({
		text: name, 
		order: orderOfUpdatedMatrix, 
		pixel: globalPixelDataUpdate })
    );
}

	</script>
</body>
</html>
